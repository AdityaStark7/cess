<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cess Notices</title>
    <link rel="stylesheet" type="text/css" href="/bitnami.css">

</head>
<body>
    <h1>Cess Notices</h1>
    
    <div>
        <label for="type">Type:</label>
        <select id="type">
            <option value="cess">Cess</option>
        </select>
    </div>
    <div>
        <label for="district">District:</label>
        <select id="district">
            <option value="north">North</option>
            <option value="south">South</option>
            <option value="east">East</option>
            <option value="northwest">North-West</option>
            <option value="southwest">South-West</option>
            <option value="northeast">North-East</option>
            <option value="southeast">South-East</option>
        </select>
    </div>
    <div>
        <label for="date">Date (DD/MM/YYYY):</label>
        <input type="text" id="date" placeholder="Enter Date">
    </div>
    <div>
        <label for="company">Company Name:</label>
        <input type="text" id="company" placeholder="Enter Company Name">
    </div>
    <div>
        <label for="serialNumber">Cess ID:</label>
        <input type="text" id="serialNumber" readonly>
    </div>
    <button onclick="generateResult()">Submit</button>
    <button onclick="resetForm()">Reset</button>
    
    <script>
        let queryCount = 0;

        function insertDataIntoDatabase(type, district, formattedDate, company) {
            const xhr = new XMLHttpRequest();
            xhr.open('POST', '/submit', true);

            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.onreadystatechange = function () {
            if (xhr.readyState === XMLHttpRequest.DONE) {
                if (xhr.status === 200) {
                  try {
                      const jsonResponse = JSON.parse(xhr.responseText);
                      // Process jsonResponse as needed
                  } catch (error) {
                      console.error('Error parsing JSON:', error);
                  }
                } else {
                    // Handle errors if any
                    console.error('Error with the server response. Status:', xhr.status);
                }
            }
        };


            const data = {
                type: type,
                district: district,
                date: formattedDate,
                company: company,
            };

            xhr.send(JSON.stringify(data));
        }
    
        function generateResult() {
            queryCount++;
            const type = document.getElementById("type").value;
            const district = document.getElementById("district").value;
            const date = document.getElementById("date").value;
            const company = document.getElementById("company").value;
            
            const dateParts = date.split('/');
            const day = parseInt(dateParts[0], 10);
            const month = parseInt(dateParts[1], 10) - 1; // Months are zero-based
            const year = parseInt(dateParts[2], 10);

            if (isNaN(day) || isNaN(month) || isNaN(year) || month < 0 || month > 11 || day < 1 || day > 31) {
                alert("Invalid! Please enter a valid date (DD/MM/YYYY).");
                return;
            }   

            const inputDate = new Date(year, month, day);

            const formattedDate = date.replace(/\//g, '');

            const serialNumber = queryCount;
            const result = `${type}/${district}/${company}/${formattedDate}/${serialNumber}`;
            document.getElementById("serialNumber").value = result;

            insertDataIntoDatabase(type, district, formattedDate, company);
        }

        function resetForm() {
            document.getElementById("type").value = "cess";
            document.getElementById("district").value = "north";
            document.getElementById("date").value = "";
            document.getElementById("company").value = "";
            document.getElementById("serialNumber").value = "";
        }
    </script>
</body>
</html>
